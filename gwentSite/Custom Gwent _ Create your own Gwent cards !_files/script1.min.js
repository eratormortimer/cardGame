function boldText(t){var e=/\*\*(\S(.*?\S)?)\*\*/g,r=t.replace(e,"<strong>$1</strong>"),i=r.replace(/___/g,"<br/>");return i}function stripHTML(t){var e=document.createElement("div"),r=document.createTextNode(t);return e.appendChild(r),e.innerHTML}jQuery(document).ready(function(t){function e(r){var i=t("#loading div img");t({deg:0}).animate({deg:r},{duration:2e3,easing:"linear",step:function(t){i.css({transform:"rotate("+t+"deg)"})},complete:function(){0==stopLoader&&e(360)}})}function r(r){r?(t("#loading").show(),stopLoader=!1,e(360)):(stopLoader=!0,t("#loading").hide())}function n(e){t.ajax({url:"/submitCard.php",type:"POST",data:e,dataType:"json",success:function(t){t.success?window.location="/cards/"+t.key:(r(!1),alert(t.message),grecaptcha.reset())},complete:function(){r(!1)},error:function(){r(!1),alert("Internal error, please contact us !"),grecaptcha.reset()}})}function a(e,r){t("#editCardBlock .positionContainer ."+e+" .label span").text(r)}function o(e){if(0==e||"0"==e)t(".previewCardBlock .card .strength .container").html("");else for(strengthRaw=e,t(".previewCardBlock .card .strength .container").html(""),i=0;i<strengthRaw.length&&(t(".previewCardBlock .card .strength .container").append('<img src="'+urlRewrite+"/img/number"+strengthRaw.charAt([i])+'.png" align="center">'),!(i>=maxNumbers-1));i++);}function c(e){var r=e;if(r=r.replace(/[^0-9\.]/g,""),t('input[name="strength"]').val(r),r.length>maxNumbers){var n="";for(i=0;i<r.length;i++){if(i>=maxNumbers){t('input[name="strength"]').val(n);break}n+=r.charAt([i])}}currentStrength=t('input[name="strength"]').val(),o(currentStrength)}"edit"==mode?(t(".canevasContainer").css("visibility","hidden"),t(".editorContainer").css("display","block")):"preview"==mode&&(t(".editorContainer").css("display","none"),t(".canevasContainer").css("visibility","visible"));var d={1:"Neutral",2:"Monsters",3:"Northern Realms",4:"Scoiatael",5:"Skellige",6:"Nilfgaardian"},l={0:"None",1:"Melee",3:"Ranged",5:"Siege",7:"Any",2:"Melee (Enemy side)",4:"Ranged (Enemy side)",6:"Siege (Enemy side)",8:"Any (Enemy side)"},s={1:"Bronze",2:"Silver",3:"Gold"};t(document).on("click touchstart","#closeAlert",function(e){e.preventDefault(),t(".alertContainer").hide(),t(".alertContainer .submitConfirm").hide()}),t(document).on("click touchstart",'input[name="cardSubmit"]',function(e){e.preventDefault(),t(".alertContainer").show(),t(".alertContainer .submitConfirm").show()}),t(document).on("click touchstart",".liCardAbility, .liCardStrength, .liCardRow, .liCardFaction, .liCardElite, .liCardType, .liCardRarity, .liCardName",function(e){2==e.which&&e.preventDefault(),location.href="/cards/"+t(this).parent().attr("data-key")}),t(document).on("click touchstart",'input[name="submitConfirm"]',function(e){e.preventDefault(),r(!0),t(".alertContainer").hide(),t(".alertContainer .submitConfirm").hide();var i={};i.image="",i.isElite=0,isElite&&(i.isElite=1),i.faction=currentFaction,i.strength=currentStrength,i.type=currentType,i.row=currentRow,i.rarity=currentRarity,i.name=t(".editorContainer .previewCardBlock .cardText .cardDescription .name").text(),i.ability=t(".editorContainer .previewCardBlock .cardText .cardDescription .abilityTextHidden").text(),i["g-recaptcha-response"]=t("#g-recaptcha-response").val(),t("#displayCardGallery").is(":checked")?i.isPublic=1:i.isPublic=0,""!=t(".editorContainer .previewCardBlock .card .bgImg img").attr("src")?html2canvas(t(".editorContainer .previewCardBlock .card .bgImg img"),{onrendered:function(e){i.image=e.toDataURL(),i.imageLeft=t(".editorContainer .previewCardBlock .card .bgImg img").css("left").split("px")[0],n(i)}}):n(i)});var u="No";isElite&&(u="Yes"),a("eliteBlock",u),a("factionBlock",d[currentFaction]),a("typeBlock",s[currentType]),a("rowBlock",l[currentRow]),t(document).on("click touchstart",'input[name="isElite"]',function(){var e="";isElite=!1,1==t(this).val()&&(e="l",isElite=!0);var r="No";isElite&&(r="Yes"),a("eliteBlock",r),t(".previewCardBlock .card .factionIcon").find("img").attr("src",urlRewrite+"/img/factionIcon"+currentFaction+e+".png")}),t(document).on("click touchstart",'input[name="factionId"]',function(){currentFaction=t(this).val(),t(".previewCardBlock .card .bgFaction").find("img").attr("src",urlRewrite+"/img/bgFaction"+currentFaction+".png"),t(".previewCardBlock .card .bgFactionIcon").find("img").attr("src",urlRewrite+"/img/bgFactionIcon"+currentFaction+".png"),t(".previewCardBlock .card .flippedFaction").find("img").attr("src",urlRewrite+"/img/flippedFaction"+currentFaction+".png"),t(".previewCardBlock .cardDescription .faction").find("img").attr("src",urlRewrite+"/img/faction"+currentFaction+".png"),a("factionBlock",d[currentFaction]);var e="";isElite&&(e="l"),t(".previewCardBlock .card .factionIcon").find("img").attr("src",urlRewrite+"/img/factionIcon"+currentFaction+e+".png")}),t(document).on("click touchstart",'input[name="typeId"]',function(){currentType=t(this).val(),"1"==imgRewrite?t(".previewCardBlock .card .type").find("img").attr("src",urlRewrite+"/img/border"+currentType+"no.png"):t(".previewCardBlock .card .type").find("img").attr("src",urlRewrite+"/img/border"+currentType+".png"),a("typeBlock",s[currentType])}),t(document).on("click touchstart",'input[name="rarityId"]',function(){currentRarity=t(this).val(),t(".previewCardBlock .card .rarity").find("img").attr("src",urlRewrite+"/img/rarity"+currentRarity+".png"),t(".previewCardBlock .cardDescription .divider").find("img").attr("src",urlRewrite+"/img/divider"+currentRarity+".png")}),t(document).on("click touchstart",'input[name="loyaltyId"]',function(){currentRow=t(this).val(),0==currentRow?(t(".previewCardBlock .card .loyalty").find("img").hide(),t("#editCardBlock .positionContainer .positionFloatleft .loyalty0").hide()):(t(".previewCardBlock .card .loyalty").find("img").show(),t("#editCardBlock .positionContainer .positionFloatleft .loyalty0").show(),t(".previewCardBlock .card .loyalty").find("img").attr("src",urlRewrite+"/img/loyalty"+currentRow+".png")),a("rowBlock",l[currentRow])}),o(currentStrength),t(document).on("keyup",'input[name="strength"]',function(){c(t(this).val())}),t(document).on("keyup",'input[name="cardName"]',function(){t(".previewCardBlock .cardDescription .name").text(t(this).val().toUpperCase())});var p=t(".previewCardBlock .cardDescription .ability"),g=t(".previewCardBlock .cardDescription .abilityTextHidden");t(document).on("keyup",'textarea[name="cardAbility"]',function(){p.text(this.value),g.text(this.value),p.html(boldText(stripHTML(p.text())))}),t(".draggableBgImg").draggable({scroll:!1,axis:"x"});var m=!1;t(".editorContainer .previewCardBlock").mousedown(function(e){return m?void(m=!1):(m=!0,void t(".draggableBgImg").trigger(e))}),t('input[name="uploadedFile"]').change(function(){var e=this;if(e.files&&e.files[0]){var r=new FileReader;r.onload=function(e){t(".previewCardBlock .card .bgImg").find("img").attr("src",e.target.result)},r.readAsDataURL(e.files[0])}}),t(document).on("click touchstart","#goToEditCard",function(){var e=t(this).attr("data-key");window.location="http://custom-gwent.com/editor/"+e}),t(document).on("click touchstart",".doVote",function(){var e=t(this).attr("data-type"),i={cardKey:t(this).attr("data-key"),way:e},n=t(this);t.ajax({url:"/submitVote.php",type:"POST",data:i,dataType:"json",success:function(r){if(r.success){var a="upVoteColor";0==r.averageVote?a="neutralVoteColor":r.averageVote<0&&(a="downVoteColor"),t("#span_"+i.cardKey).removeClass("upVoteColor"),t("#span_"+i.cardKey).removeClass("neutralVoteColor"),t("#span_"+i.cardKey).removeClass("downVoteColor"),1==e?(t(n).find("img").attr("src","/img/upVote.png"),t(n).parent(".verticalAlign").find("#downVote").find("img").attr("src","/img/downVoteDone.png")):(t(n).parent(".verticalAlign").find("#upVote").find("img").attr("src","/img/upVoteDone.png"),t(n).find("img").attr("src","/img/downVote.png")),t("#span_"+i.cardKey).addClass(a),t("#span_"+i.cardKey).text(r.averageVote)}},complete:function(){},error:function(){r(!1),alert("Internal error, please contact us !")}})}),t(document).on("click touchstart","#hideCardActions",function(){t(".cardActions").hide()}),t(document).on("click touchstart","#goToDownloadCard",function(){var e=t(this).attr("data-key");r(!0),t(".cardActions").hide(),t(".cardWaterMark").show(),html2canvas(t(".canevasContainer"),{onrendered:function(i){download(i.toDataURL(),"gwent_custom_"+e+".png","image/png"),t(".cardActions").show(),t(".cardWaterMark").hide(),r(!1)}})}),t.fn.customerPopup=function(t,e,r,i){t.preventDefault(),e=e||"500",r=r||"400",strResize=i?"yes":"no";var n="undefined"!=typeof this.attr("title")?this.attr("title"):"Social Share",a="width="+e+",height="+r+",resizable="+strResize;window.open(this.attr("href"),n,a).focus()},t(".customer.share").on("click touchstart",function(e){t(this).customerPopup(e)}),t(".previewCardAbility").html(boldText(stripHTML(t(".previewCardAbility").text())))});